# 週報アプリケーション 設計仕様書

**作成日**: 2025-12-10  
**バージョン**: 1.0（ドラフト）

---

## 1. 概要

### 1.1 目的
- 週次業務報告を効率的に作成・管理するシステム
- 前週との差分表示により、進捗状況を可視化
- 承認ワークフローによる確認プロセスの管理

### 1.2 利用者
- 約30名の同時利用を想定
- 役割: 担当者、点検者、承認者

### 1.3 技術スタック
- データベース: SQLite
- 保存場所: ネットワークドライブ（UNCパス対応）
- 同時アクセス対策: WALモード、自動リトライ機能

---

## 2. 基本仕様

### 2.1 週の定義
- **週の始まり**: 月曜日
- **週の期間**: 月曜日〜日曜日（7日間）
- **表示形式**: `2025/12/1 - 12/7`

### 2.2 データ構造

#### 2.2.1 階層構造（2階層）
```
大項目（マスタ管理）
 └─ 小項目（自由入力）

例:
開発
 ├─ 機能A
 └─ 機能B

新技術調査
 ├─ AI
 └─ 自動運転
```

#### 2.2.2 大項目マスタ
- **管理者**: 承認者のみ編集可能
- **内容**: 大項目の名称リスト
- **例**: 開発、新技術調査、エネルギー、インフラ

#### 2.2.3 小項目
- **マスタ不要**: 自由入力
- **柔軟性**: プロジェクトや業務内容に応じて自由に記載

---

## 3. 週報の構成要素

### 3.1 基本情報
| 項目 | 内容 | 必須 | 備考 |
|-----|------|------|------|
| 報告週 | 対象週の期間 | ○ | 自動計算可能 |
| 作成者 | 週報作成者 | ○ | 自動取得 |
| 作成日時 | 初回作成日時 | ○ | 自動記録 |
| 更新日時 | 最終更新日時 | ○ | 自動更新 |

### 3.2 確認欄（承認ワークフロー）

```
担当者: □Aさん □Bさん
点検者: □Cさん
承認者: □Dさん
```

**ルール**:
- **担当者が複数の場合**: 誰か1人がチェックすればOK
- **チェックの順序**: 自由（承認者が直接チェック可能）
- **チェック後の編集**: 可能（変更点を明示）

**確認状態**:
- 未確認
- 確認済み
- 確認者名
- 確認日時

### 3.3 実績

**構造**:
```
[大項目: 開発]
  小項目: 機能A
    ・設計レビュー完了
    ・プロトタイプ作成
    ・性能測定実施
  
  小項目: 機能B
    ・テスト環境構築中
    ・単体テスト実施
```

**特徴**:
- **自由記述**: 複数行記載可能
- **前週との比較表示**: 前週の内容と並べて表示
- **差分の可視化**: 新規追加、変更箇所を明示

### 3.4 予定

**構造**:
```
予定:
  ・機能Cの設計開始（来週）
  ・機能Dのレビュー（12/15）
  ・新技術調査ミーティング（12月中旬）
```

**特徴**:
- **まとめて記載**: 来週以降の予定を自由記述
- **期限管理**: 日程登録しているもので期限のものは記載項目に自動表示
- **先週の予定との対応**: 先週立てた予定の実施状況を確認可能

### 3.5 備考
- **自由記述**: その他のメモ、特記事項など

---

## 4. UI設計

### 4.1 画面レイアウト

```
┌─────────────┬──────────────────────────────────┐
│             │  報告週: 2025/12/1 - 12/7        │
│  項目選択   │                                  │
│             │  確認欄:                         │
│  ☑ 開発    │    担当者: □Aさん ☑Bさん        │
│    ☑ 機能A │    点検者: □Cさん               │
│    □ 機能B │    承認者: □Dさん               │
│             │                                  │
│  ☑ 新技術  │  実績:                           │
│    ☑ AI    │  [開発 > 機能A]                 │
│    □ IoT   │  ・設計レビュー完了              │
│             │  ・プロトタイプ作成              │
│  □ エネル  │                                  │
│    □ 自己  │  [新技術調査 > AI]              │
│             │  ・論文調査                      │
│             │                                  │
│             │  予定:                           │
│             │  ・機能Bのテスト開始（来週）     │
│             │                                  │
│             │  備考:                           │
│             │  ・特記事項なし                  │
└─────────────┴──────────────────────────────────┘
```

### 4.2 左側：項目選択ツリー

**機能**:
- 週報作成時に記載する項目を選択
- チェックボックスで選択・解除
- 選択した項目のみ実績入力欄に表示

**動作**:
- 大項目をクリック → 展開/折りたたみ
- 小項目にチェック → 右側に入力欄表示

### 4.3 右側：週報入力・表示エリア

**セクション**:
1. 報告週（期間選択または自動設定）
2. 確認欄（チェックボックス）
3. 実績（項目ごとに入力欄）
4. 予定（自由記述 + 期限管理項目の自動表示）
5. 備考（自由記述）

---

## 5. 機能要件

### 5.1 週報作成
- 対象週の選択（デフォルトは当週）
- 左側ツリーから項目を選択
- 実績を自由記述形式で入力
- 予定を入力（日付指定可能）
- 備考を入力

### 5.2 週報閲覧
- 週報一覧表示
- 特定の週を指定して表示
- 期間指定（例: 2025年1月〜3月）
- キーワード検索

### 5.3 週報編集
- 既存の週報を編集
- 編集履歴の記録
- チェック後の編集時は変更点を明示

### 5.4 週報削除
- 確認ダイアログ付き削除
- 論理削除（物理削除はオプション）

### 5.5 前週との比較
- 前週の実績・予定を並べて表示
- 差分の可視化（新規/変更/削除）
- 先週の予定 → 今週の実績の対応関係表示

### 5.6 確認・承認機能
- 担当者・点検者・承認者のチェック
- チェック状態の記録（誰が・いつ）
- チェック後の編集通知

### 5.7 マスタ管理
- 大項目マスタの追加・編集・削除
- 承認者のみアクセス可能

---

## 6. データベース設計（案）

### 6.1 テーブル構成

#### 6.1.1 週報テーブル（weekly_reports）
| カラム名 | 型 | NULL | 備考 |
|---------|-----|------|------|
| id | INTEGER | NOT NULL | PRIMARY KEY |
| week_start_date | TEXT | NOT NULL | 週の開始日（月曜日） |
| week_end_date | TEXT | NOT NULL | 週の終了日（日曜日） |
| creator | TEXT | NOT NULL | 作成者 |
| created_at | TEXT | NOT NULL | 作成日時 |
| updated_at | TEXT | NOT NULL | 更新日時 |
| remarks | TEXT | | 備考 |
| is_deleted | INTEGER | NOT NULL | 論理削除フラグ（0/1） |

**インデックス**:
- `idx_week_start_date` ON week_start_date
- `idx_creator` ON creator

#### 6.1.2 確認状況テーブル（approval_status）
| カラム名 | 型 | NULL | 備考 |
|---------|-----|------|------|
| id | INTEGER | NOT NULL | PRIMARY KEY |
| report_id | INTEGER | NOT NULL | FOREIGN KEY → weekly_reports.id |
| role | TEXT | NOT NULL | 役割（担当者/点検者/承認者） |
| checker_name | TEXT | NOT NULL | 確認者名 |
| is_checked | INTEGER | NOT NULL | チェック状態（0/1） |
| checked_at | TEXT | | チェック日時 |

#### 6.1.3 実績テーブル（achievements）
| カラム名 | 型 | NULL | 備考 |
|---------|-----|------|------|
| id | INTEGER | NOT NULL | PRIMARY KEY |
| report_id | INTEGER | NOT NULL | FOREIGN KEY → weekly_reports.id |
| major_category | TEXT | NOT NULL | 大項目 |
| minor_category | TEXT | NOT NULL | 小項目 |
| content | TEXT | NOT NULL | 実績内容（複数行） |
| sort_order | INTEGER | NOT NULL | 表示順序 |

#### 6.1.4 予定テーブル（plans）
| カラム名 | 型 | NULL | 備考 |
|---------|-----|------|------|
| id | INTEGER | NOT NULL | PRIMARY KEY |
| report_id | INTEGER | NOT NULL | FOREIGN KEY → weekly_reports.id |
| content | TEXT | NOT NULL | 予定内容 |
| due_date | TEXT | | 期限日（あれば） |
| sort_order | INTEGER | NOT NULL | 表示順序 |

#### 6.1.5 大項目マスタテーブル（major_categories）
| カラム名 | 型 | NULL | 備考 |
|---------|-----|------|------|
| id | INTEGER | NOT NULL | PRIMARY KEY |
| name | TEXT | NOT NULL | 大項目名 |
| sort_order | INTEGER | NOT NULL | 表示順序 |
| is_active | INTEGER | NOT NULL | 有効フラグ（0/1） |

#### 6.1.6 編集履歴テーブル（edit_history）
| カラム名 | 型 | NULL | 備考 |
|---------|-----|------|------|
| id | INTEGER | NOT NULL | PRIMARY KEY |
| report_id | INTEGER | NOT NULL | FOREIGN KEY → weekly_reports.id |
| editor | TEXT | NOT NULL | 編集者 |
| edited_at | TEXT | NOT NULL | 編集日時 |
| edit_type | TEXT | NOT NULL | 編集種別（作成/更新/削除） |
| changes | TEXT | | 変更内容（JSON形式） |

---

## 7. 未確定事項（要検討）

### 7.1 予定の対応状況管理

**課題**: 先週の予定 → 今週の実績の紐付け方法

**選択肢**:
- 案1: ステータス管理（完了/進行中/未着手）
- 案2: 自動引き継ぎ（先週の予定が今週の実績欄に自動表示）
- 案3: 手動対応（並べて表示するのみ）

### 7.2 期限管理項目の自動表示

**課題**: 「日程登録しているもので記載期限のもの」の実装方法

**選択肢**:
- 案1: 予定マスタを作成（別途タスク管理）
- 案2: 過去の週報の予定から自動抽出
- 案3: 外部システム連携

### 7.3 チェック後の変更点明示

**課題**: 承認後に編集した場合の通知方法

**選択肢**:
- 案1: 変更履歴を詳細表示
- 案2: 変更箇所をハイライト表示
- 案3: 再承認フローを起動

### 7.4 項目選択の記憶

**課題**: 前回選択した項目をデフォルト選択するか

**選択肢**:
- 案1: 前回選択項目を記憶（ユーザーごと）
- 案2: 毎回リセット（空の状態から）
- 案3: テンプレート機能（保存・呼び出し）

---

## 8. 非機能要件

### 8.1 パフォーマンス
- 30人の同時アクセスに対応
- WALモード、自動リトライによるロック対策
- タイムアウト: 30秒
- リトライ回数: 最大5回

### 8.2 セキュリティ
- ネットワークドライブのアクセス権限に依存
- 承認者のみマスタ編集可能
- 編集履歴の記録

### 8.3 可用性
- ネットワークドライブの可用性に依存
- 定期バックアップ推奨

### 8.4 保守性
- SQLiteによるシンプルな構成
- データエクスポート機能（CSV等）

---

## 9. 今後の検討事項

### 9.1 短期（初期リリース前）
- [ ] 未確定事項（7章）の決定
- [ ] UI詳細設計
- [ ] データベース詳細設計
- [ ] 実装方針の決定（CLI / GUI / Web）

### 9.2 中期（リリース後）
- [ ] 予定と実績の自動紐付け機能
- [ ] 週報テンプレート機能
- [ ] グラフ・統計表示
- [ ] Excel/PDFエクスポート

### 9.3 長期（運用改善）
- [ ] 外部システム連携（タスク管理ツール等）
- [ ] メール通知機能
- [ ] モバイル対応
- [ ] サーバー版への移行検討（利用者増加時）

---

## 10. 参考：日報アプリとの比較

| 項目 | 日報アプリ | 週報アプリ |
|-----|----------|-----------|
| 記録単位 | 1日 | 1週間 |
| 項目構造 | フラット | 2階層ツリー |
| 承認フロー | なし | あり（担当者→点検者→承認者） |
| 前回比較 | なし | あり |
| 予定管理 | 翌日のみ | 来週以降 |
| マスタ管理 | なし | 大項目マスタあり |

---

## 11. 変更履歴

| 日付 | バージョン | 変更内容 | 担当 |
|-----|-----------|---------|------|
| 2025-12-10 | 1.0 | 初版作成 | - |

---

**以上**
